<!DOCTYPE html>
<html>
    <head>
        <title>asyncio.runners &mdash; Bernard</title>

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <link rel="shortcut icon" href="../../../_static/favicon.ico" />

        <link rel="stylesheet" href="../../../_static/bootstrap/css/bootstrap.min.css" type="text/css" />
        <link rel="stylesheet" href="../../../_static/bernard.css" type="text/css" />
        <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
        <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
        <link rel="stylesheet" href="../../../_static/bernard.css" type="text/css" />

        <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT       : '../../../',
            VERSION        : '',
            COLLAPSE_INDEX : false,
            FILE_SUFFIX    : '.html',
            HAS_SOURCE     : true
        };
        </script>

        
    </head>

    <body>
        <div class="ribbon">
            <a href="https://github.com/bernardphp/bernard">Fork me on GitHub!</a>
        </div>

        <div class="container text-center">
            <a class="logo" href="http://bernardphp.com">Bernard</a>
        </div>

        <hr />

        <div class="container">
            <div class="row">
                <div class="col-md-3 toc">
                    

                    
                        <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../placeholder-one/">Placeholder Page One</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../placeholder-two/">Placeholder Page Two</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../placeholder-three/">Placeholder Page Three</a></li>
</ul>
<p class="caption"><span class="caption-text">Using this theme</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart/">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../quickstart/#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../kitchen-sink/">Kitchen Sink</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../kitchen-sink/paragraph-markup/">Paragraph Level Markup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kitchen-sink/api/">API documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kitchen-sink/lists-and-tables/">Lists &amp; Tables</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Additional Pages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../long-page/">Long Page</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../long-page/#document-section">Document Section</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../long-page/#section-2">Section 2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://sphinx-themes.org">Sphinx Theme Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../really-long-title/">This is just a page with a really long title for checking how the theme handles these situations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../placeholder-four/">Placeholder Page Four</a></li>
</ul>

                    

                    <a href="#" class="navbar-toggle">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                </div>

                <div class="col-md-9 body">
                    
  <h1>Source code for asyncio.runners</h1><div class="highlight"><pre>
<span></span><span class="n">__all__</span> <span class="o">=</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">coroutines</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">events</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">tasks</span>


<div class="viewcode-block" id="run"><a class="viewcode-back" href="../../../kitchen-sink/api/#asyncio.run">[docs]</a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Execute the coroutine and return the result.</span>

<span class="sd">    This function runs the passed coroutine, taking care of</span>
<span class="sd">    managing the asyncio event loop and finalizing asynchronous</span>
<span class="sd">    generators.</span>

<span class="sd">    This function cannot be called when another asyncio event loop is</span>
<span class="sd">    running in the same thread.</span>

<span class="sd">    If debug is True, the event loop will be run in debug mode.</span>

<span class="sd">    This function always creates a new event loop and closes it at the end.</span>
<span class="sd">    It should be used as a main entry point for asyncio programs, and should</span>
<span class="sd">    ideally only be called once.</span>

<span class="sd">    Example:</span>

<span class="sd">        async def main():</span>
<span class="sd">            await asyncio.sleep(1)</span>
<span class="sd">            print(&#39;hello&#39;)</span>

<span class="sd">        asyncio.run(main())</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">events</span><span class="o">.</span><span class="n">_get_running_loop</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;asyncio.run() cannot be called from a running event loop&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">coroutines</span><span class="o">.</span><span class="n">iscoroutine</span><span class="p">(</span><span class="n">main</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;a coroutine was expected, got </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">main</span><span class="p">))</span>

    <span class="n">loop</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">new_event_loop</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">events</span><span class="o">.</span><span class="n">set_event_loop</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loop</span><span class="o">.</span><span class="n">set_debug</span><span class="p">(</span><span class="n">debug</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_cancel_all_tasks</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
            <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">loop</span><span class="o">.</span><span class="n">shutdown_asyncgens</span><span class="p">())</span>
            <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">loop</span><span class="o">.</span><span class="n">shutdown_default_executor</span><span class="p">())</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">events</span><span class="o">.</span><span class="n">set_event_loop</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<span class="k">def</span> <span class="nf">_cancel_all_tasks</span><span class="p">(</span><span class="n">loop</span><span class="p">):</span>
    <span class="n">to_cancel</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">all_tasks</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">to_cancel</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">to_cancel</span><span class="p">:</span>
        <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">to_cancel</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">to_cancel</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">cancelled</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loop</span><span class="o">.</span><span class="n">call_exception_handler</span><span class="p">({</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;unhandled exception during asyncio.run() shutdown&#39;</span><span class="p">,</span>
                <span class="s1">&#39;exception&#39;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">exception</span><span class="p">(),</span>
                <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="n">task</span><span class="p">,</span>
            <span class="p">})</span>
</pre></div>

                </div>

                <div class="container">
                    
                </div>
            </div>
        </div>
            <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
            <script type="text/javascript" src="../../../_static/jquery.js"></script>
            <script type="text/javascript" src="../../../_static/underscore.js"></script>
            <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/bernard.js"></script>
    </body>
</html>